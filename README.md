# Rapid-prototyping protection schemes with IEC 61850 #

The goal of this software is to automatically generate C/C++ code which reads and writes GOOSE and Sampled Value packets. Any valid IEC 61850 Substation Configuration Description (SCD) file, describing GOOSE and/or SV communications, can be used as the input. The output code is lightweight and platform-independent, so it can run on a variety of devices, including low-cost microcontrollers. It's ideal for rapid-prototyping new protection and control systems that require communications.

*The code is meant to be a proof of concept, and is highly experimental. It has not been tested on many SCD files.*


## Installation ##

The software requires Eclipse, with the Eclipse Modeling Framework (EMF). Java Emitter Templates (JET) is also required. There are two source code trees: `emf` (in Java), and `c` (obviously written in C). Each should be a separate project in Eclipse.

The Java project `src` directory is organised as follows:

 - `sclToC/`: code that does the bulk of the conversion from SCD file to C code. The class `SCLCodeGenerator` contains the `main()` function for the project.
 - `sclToCHelper/`: helper classes that are generated by JET.
 - `model/`: the IEC 61850 XML Schema files. EMF uses these to generate the model.
 - `templates/`: the template source files used by JET.

<!-- Describe EMF import process -->
For the `emf` project, go to Project Properties > JET Settings, and set Template Containers to "templates", and Source Container to "src".

Many of the C files are generated automatically.

### Example ###

An example SCD file and a `main.c` file are provided. For the C code to compile on Windows, you should have MinGW installed and add `C:\MinGW\bin;` to `PATH` in the Project Properties > C/C++ Build > Environment options. (Other compilers should work too.) Also, in Project Properties > C/C++ Build > Settings > MinGW C Linker, add `wpcap` and `ws2_32` to "Libraries" and add `"C:\MinGW\lib"` to "Library search path".


## Known issues and possible features ##

 - only include items in SV packets if set to true in SmvOpts; see page 83 of 61850-6

 - Inputs - find ExtRef DA satisfied by container DO within a dataset, where the DA is not explicitly in a dataset

 - default values (including DOI and DAI), and allocate memory for strings
   typical values are set in DataTypeTemplates section (DA and BDA, both sub-types of AbstractDataType, may have Val elements)
   special case values are set in LN definition

 - ensure all dataset elements are in the same order as in the SCD
 - ensure all data types in C code are in an order that can be compiled
 - ensure C string literals are "safe", i.e. "\\" instead of "\"

 - put svData and gseData instances inside LLN0 definition

 - need way of specifying implemented IED, and generating only this IED. But keep existing mode - may be useful for simulating an entire substation?
   i.e., two modes of use.
   could create a virtual Ethernet bus (Ethernot?) where all generated packets are broadcast to all IEDs/AccessPoints
 